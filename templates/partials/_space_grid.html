{% comment %}
Renders a visual grid of a location's spaces, showing which are occupied or
available for placing new child locations.

This partial is used in the Location Configuration app.

Context Variables:
  - grid: A 2D list representing the grid of spaces, generated by the
          `generate_space_grid` utility function.
  - parent_location: The Location object instance that owns the spaces.
{% endcomment %}
{% load grid_helpers %}

<div class="space-grid" data-cols="{{ parent_location.source_location_type.space_cols }}">
    {% for row in grid %}
        {% for cell in row %}
            {% if cell.occupant_type == 'location' %}
                {# A cell occupied by another Location. Rendered as a non-clickable, styled div. #}
                <div class="space-cell space-interactable" title="Occupied by Location: {{ cell.occupant_name }}">
                    <span class="space-coords">{{ cell.row|to_row_letter }}{{ cell.col }}</span>
                    <span class="occupant-name">{{ cell.occupant_name }}</span>
                </div>

            {% elif cell.occupant_name %}
                {# A cell occupied by a non-location item (e.g., a sample). Rendered as a disabled div. #}
                <div class="space-cell space-occupied" title="Occupied by {{ cell.occupant_name }}">
                    <span class="space-coords">{{ cell.row|to_row_letter }}{{ cell.col }}</span>
                    <span class="occupant-name">{{ cell.occupant_name }}</span>
                </div>

            {% else %}
                {# An available cell. Rendered as a link to the 'add child in space' view. #}
                <a
                    href="{% url 'location_configuration:location_add_child_in_space' parent_pk=parent_location.pk space_row=cell.row space_col=cell.col %}"
                    class="space-cell space-available"
                >
                    <span class="space-coords">{{ cell.row|to_row_letter }}{{ cell.col }}</span>
                    <span>Available</span>
                </a>
            {% endif %}
        {% endfor %}
    {% endfor %}
</div>